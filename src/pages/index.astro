---
import BaseLayout from '../layouts/BaseLayout.astro';
import VideoCard from '../components/VideoCard.jsx';

// Load all content at build time
const postModules = import.meta.glob('../content/posts/*.mdx', { eager: true });
const videoModules = import.meta.glob('../content/videos/*.mdx', { eager: true });

function extractContent(modules) {
  return Object.values(modules).map((mod) => {
    const slug = mod.file.split('/').pop()?.replace(/\.\w+$/, '') || '';
    return { slug, frontmatter: mod.frontmatter || {} };
  });
}

const posts = extractContent(postModules).sort((a, b) => {
  const dateA = new Date(a.frontmatter.date || 0);
  const dateB = new Date(b.frontmatter.date || 0);
  return dateB - dateA;
});

const videos = extractContent(videoModules);
---

<BaseLayout title="VK â€” Software Engineer" description="Personal Blog & Vlog of VK">
  <!-- Hero Section -->
  <section class="py-16 md:py-24">
    <div class="max-w-4xl mx-auto text-center px-4">
      <div class="inline-flex items-center gap-2 bg-violet-50 dark:bg-slate-800/50 px-3 py-1 rounded-full text-sm text-violet-700 dark:text-violet-400 mb-6">
        <span class="w-1.5 h-1.5 rounded-full bg-violet-500"></span>
        Software Engineer & Researcher
      </div>

      <h1 class="text-4xl md:text-6xl font-bold bg-gradient-to-r from-slate-900 via-slate-800 to-slate-700 dark:from-slate-100 dark:via-slate-200 dark:to-slate-300 bg-clip-text text-transparent mb-6">
        Hi, Iâ€™m <span class="text-transparent bg-clip-text bg-gradient-to-r from-violet-600 to-indigo-600">VK</span>
      </h1>

      <p class="text-lg text-slate-600 dark:text-slate-400 max-w-2xl mx-auto mb-10 leading-relaxed">
        Building secure systems â€¢ Architecting resilient infrastructure â€¢ Exploring robotics & cybersecurity.
      </p>

      <div class="flex flex-wrap justify-center gap-4">
        <a
          href="/blog"
          class="px-6 py-3 bg-violet-600 text-white font-medium rounded-xl hover:bg-violet-700 transition-all shadow-lg hover:shadow-violet-500/20"
        >
          Read Blog
        </a>
        <a
          href="/vlog"
          class="px-6 py-3 border border-slate-300 dark:border-slate-700 font-medium rounded-xl hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors"
        >
          Watch Vlogs
        </a>
      </div>
    </div>
  </section>

  <!-- Latest Posts -->
  <section class="py-12 md:py-16">
    <div class="max-w-6xl mx-auto px-4">
      <div class="flex items-center justify-between mb-8">
        <h2 class="text-2xl font-bold text-slate-900 dark:text-white">Latest Posts</h2>
        <a href="/blog" class="text-sm text-violet-600 dark:text-violet-400 hover:underline">View all â†’</a>
      </div>

      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
        {posts.slice(0, 3).map((p) => (
          <article
            class="group p-5 border border-slate-200 dark:border-slate-800 rounded-2xl bg-white dark:bg-slate-900 hover:shadow-lg hover:border-violet-200 dark:hover:border-violet-900/50 transition-all duration-300"
          >
            {p.frontmatter.image && (
              <div class="relative aspect-video mb-4">
                <img
                  src={p.frontmatter.image}
                  alt={`Preview for: ${p.frontmatter.title}`}
                  class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
                  onError={(e) => {
                    e.target.src = '/images/placeholder-post.jpg';
                  }}
                />
              </div>
            )}

            <a href={`/blog/${p.slug}`} class="block">
              <h3 class="font-bold text-lg text-slate-900 dark:text-white group-hover:text-violet-600 dark:group-hover:text-violet-400 transition-colors">
                {p.frontmatter.title || 'Untitled'}
              </h3>
            </a>

            {p.frontmatter.date && (
              <p class="text-sm text-slate-500 dark:text-slate-400 mt-2">{p.frontmatter.date}</p>
            )}

            {p.frontmatter.description && (
              <p class="mt-3 text-slate-600 dark:text-slate-300 line-clamp-2">
                {p.frontmatter.description}
              </p>
            )}
          </article>
        ))}
      </div>
    </div>
  </section>

  <!-- Latest Videos -->
  <section class="py-12 md:py-16">
    <div class="max-w-6xl mx-auto px-4">
      <div class="flex items-center justify-between mb-8">
        <h2 class="text-2xl font-bold text-slate-900 dark:text-white">Latest Videos</h2>
        <a href="/vlog" class="text-sm text-violet-600 dark:text-violet-400 hover:underline">View all â†’</a>
      </div>

      {videos.length > 0 ? (
        <div class="grid md:grid-cols-2 gap-6">
          {videos.slice(0, 4).map((v) => (
            <div key={v.slug} class="flex justify-center">
              <VideoCard
                id={v.frontmatter.videoId}
                title={v.frontmatter.title}
                image={v.frontmatter.image}  <!-- ðŸ‘ˆ Pass image -->
              />
            </div>
          ))}
        </div>
      ) : (
        <p class="text-slate-500 text-center py-8">No videos published yet.</p>
      )}
    </div>
  </section>
</BaseLayout>